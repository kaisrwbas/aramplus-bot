name: ðŸš€ AramPlus Test Run
on:
  workflow_dispatch:  # Allows manual run (no cron yet)

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          pip install yfinance==0.2.66 vectorbt==0.28.1

      - name: Create minimal aramplus.py
        run: |
          echo 'print("âœ… Script started")' > aramplus.py
          echo 'with open("signal.txt", "w") as f: f.write("HOLD")' >> aramplus.py
          echo 'with open("price.txt", "w") as f: f.write("90000.00")' >> aramplus.py
          echo 'print("âœ… Files saved â€” no /content/ used!")' >> aramplus.py

      - name: Run script
        run: python aramplus.py

      - name: Show files created
        run: |
          ls -la
          cat signal.txt price.txt

      - name: Send Telegram Signal
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          SIGNAL=$(cat signal.txt)
          PRICE=$(cat price.txt)
          MSG="âœ… AramPlus Test%0APrice: \$${PRICE}%0ASignal: ${SIGNAL}"
          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${CHAT_ID}&text=${MSG}&parse_mode=Markdown"
